# Shopping Website (Server Version)
## Authors: Shuhan Han, Maha Fouda, Nnamdi Echegini, David Currey & MichaÃ«l Boisvenu-Landry

Build a fully functional demonstration shopping website with dynamic front-end and back-end.

### Features
- Fully MVC (Model-View-Controller)
- User registration
- Real user authentication with tokens
- Session management
- Updateable user profile
- JSON parsing for products
- Products with categories and variable sale data
- Seperate view for each product
- Robust shopping page with categories and pagination
- Search functionality
- Cart system with ability to modify quantities, remove items, and clear cart
- Cart maintenance throughout sessions
- Dummy checkout system (no real payment processing)
- Invoice and order maintenance
- Dummy rating system (no reviews, just ratings on a scale of 1 to 5)

### Stack
- Laravel 10.x with PHP 8.1
- HTML5/CSS/JS
- Composer
- MySQL Community Edition
- Tested on Chrome, Firefox, Edge, Safari, Brave

### Project Structure
There are a lot of folders generated by Laravel and Composer. This project does not utilize but there are a few key folders that get utilized for this project.

**Routes Directory**
This directory contains one file of importance which is web.php. Responsible for calling the correct controller functions based on the URL structure. More details will ensue.

**Resources Directory**
This directory contains the Views directory which contains all the HTML and HTML Blade components for constructing the views within the Views/Pages directory and Views/Components directory respectively. The CSS and JS directories are unused in this project but would be utilized if a bundler such as Vite where to be hosted on the server.

**Public Directory**
This directory hosts all the public facing files needed to style the website. It contains CSS files for Bootstrap and other styling necessities as well as any JavaScript files needed to run the website (NOTE that much of the CSS is done using Bootstrap 5, as well as embedded CSS in the new-layout.blade.php file in resources/components). Some of the global CSS can be observed in css/style_global.css, many of the other files are unused and are remenants of previous iterations of this project. Most of the images used for products can be found in the Images directory.

**Database Directory**
This directory is mostly used for development, but there is one key directory used by Laravel for database interaction, which is the Migrations directory. This directory hosts all the Laravel migrations created, which allow the programmer to design tables and relationships using PHP that get applied to the database when the command `php artisan migrate` is executed. The database also contains a table used to keep track of migrations.

This project contains 17 Laravel migrations, in order starting with 2014 there are as follows:
1. Creates users table (generated by Laravel, modified by the team to include extra data).
2. Creates password_reset_tokens table (generated by Laravel, unused in the scope of this project).
3. Creates failed_jobs table (generated by Laravel, unused in the scope of this project).
4. Creates personal_access_tokens table (generated by Laravel, unused in the scope of this project).
5. Creates product_category table. This table is used as 1:M relation between Product and itself (Product can have one category, category can have many products).
6. Creates products table, this table contains all data for all products used in the project. It also contains certain booleans for whether or not a product is on sale, as well as a product's rating.
7. Creates cart table. Establishes the relation between a User and a Cart (Products not checked out). Cart has an ID to assosciate it to a User.
8. Creates cart_item table. This table is used to establish the M:M relationship between a Cart and a Product.
9. Creates orders table, assosciates a processed Cart to a User via 1:M, User can have many Orders but an Order can only have one User.
10. Creates comments table. This table went unused in final version of the project, and was deemed out of scope.
11. Updates the users table, adds a column to store a profile picture.
12. Modifies the blob used for profile picture to a longblob data type by directly exeucting a DML statement on the database.
13. Updates products table to include a picture, unused and reverted in 15.
14. Modifes data type for photo column in products table by directly executing DML on the table, unused and is reverted back in 15.
15. Modifies data type for photo column to varchar(255), instead of storing pictures as binary we decided to store a path to the photo instead.
16. Adds shipping information columns to Orders, mostly for demonstration purposes.
17. Adds delivery status information to Orders, mostly for demonstration purposes.

The Database directory also has Factories and Seeders, which were used during development to seed the database with dummy data. This data has been removed from the final version of the project.

**App Directory**
This directory has 2 directories of interest, Http/Controllers and Models. The Models directory hosts all the Eloquent models used to represent database entities. Http/Controllers hosts all the controller classes used in this project, each controller will be explained in greater detail later.

**Other Files/Directories of Note**
The public/test directory contains two JSON files that need to be imported via MySQL workbench, they contain all the data for the Products that get displayed on the site.

The .env (or .env.example if you are cloning from GitHub) are environment variable files used to launch the server.
**IMPORTANT**
If cloning the repository from GitHub, it is imperative to copy all the contents of .env.example to a new file in the same directory called .env. Here you can modify your database connectivity information in the `DB_` environment variables.

It is also imperative to generate a unique key to host the application. This can be done after .env has been created and executing the command `php artisan key:generate` in a terminal pointed at the project root directory.

---

## Views
All views are found in resources/views/pages directory. All views are nexted within a tag `<x-new-layout></x-new-layout>` Blade component, see **Components** section.

### cart.blade.php
#### Author: Michael Boisvenu-Landry, Shuhan Han
HTML and Blade templating for the cart page. Uses PHP to create table rows for each item in the cart, with duplicate items residing in a single row thanks to the structure of the CartItems model.

### checkout-summary.blade.php
#### Author: Michael Boisvenu-Landry
Similar to `cart.blade.php`, and has mostly the same structure but a different form to submit a cart and create an order.

### home.blade.php
#### Author: Michael Boisvenu-Landry, Shuhan Han
Default home page of site, features a carousel and different products seperated by creation_date/price/on_sale.

### login.blade.php
#### Author: Maha Fouda
Login page for site, contains server-side and client-side validation. Authentication happens in `UserController`.

### order.blade.php
#### Author: Michael Boisvenu-Landry
Simple view that displays cart data based on whatever Order entity passed to it via controller.

### product-create-blade.php
#### Author: Shuhan Han
View used to add new products to the database.

### product-listing.blade.php
#### Author: Michael Boisvenu-Landry
Main 'shopping' page of the site, users can change the categories of the products here, add products to cart if logged in. Also features pagination front-end logic.

### product.blade.php
#### Author: David Currey
Product view for displaying product information, as well as ability to add to a cart if user is logged in.

### register.blade.php
#### Author: Maha Fouda
Registration page for a new user, uses server-side and client-side validation. User is redirected to `home.blade.php` after succesful registration and is authenticated, User entity added to database via `UserController`.

### search-results.blade.php
#### Author: David Currey
Page displaying results of a search. Products can be added to cart from this page, or be directed to that product's specific product page.

### user-profile.blade.php
#### Author: Michael Boisvenu-Landry
Page representing a user. An authenticated user can modify shipping information, change user name and profile picture, as well as view previous orders from this page.

---

## Components
All components can be found in the resources/views/components directory. Components are reusable bits of HTML and PHP that can be utilized like regular HTML tags via Laravel's Blade templating engine. Data can be passed to these components akin to props in React/React-Native. The syntax for using a component in views is `<x-component-name></x-component-name>`. The *temp* directory in the components directory can be ignored and are deprecated in this project iteration.

### carousel.blade.php
#### Author: Shuhan Han
A Bootstrap carousel used in the site's home page.

### home-products.blade.php
#### Author: Michael Boisvenu-Landry
Displays product information for diffent products on the home page. These components are utilized in a PHP block in `home.blade.php`.

### navbar.blade.php
#### Author: Michael Boisvenu-Landry
The top-most menu used throughout the website.

### new-layout.blade.php
#### Author: Nnamdi Echegini(CSS), Maha Fouda(CSS), Michael Boisvenu-Landry(HTML/JS for Menu)
The global container for views throughout the project. Each view is nested with this component. It includes the `<!DOCTYPE>`, `<html>`, `<head>`, and `<body>`, `<style>`, `<script>`, `<meta>` and `<link>` tags needed for each page. A majority of the CSS is built into a `<style>` tag, this was done to avoid having to bundle our assetts, which would generally be done in a production environment. To avoid complicating the deployment of this site and its server, we have opted to embed commonly used CSS and JS into their rescpective tags in this component. Views are passed to this tag in the body with the `$slot` variable. This means that any HTML and PHP used within `<x-new-layout>` tags will populate `$slot`.

### product-card.blade.php
#### Author: Michael Boisvenu-Landry
A variation of a product card used for the search results page and product category pages. Displays needed product data for the card. Multiple of these components are used in a single view.

### searchbar.blade.php
#### Author: David Currey
The searchbar form used in the `<x-navbar>` component. Leads the user to the search results page.

---

## Controllers
These files contain the majority of the back-end logic for the site. Each controller will have each method described in an over-arching capacity. Controllers can be found in the app/Http/Controllers directory.

### CartController.php
#### Author: Michael Boisvenu-Landry, Shuhan Han
Controller used to manage cart, does not contain adding a product to the cart, this functionality can be found in `ProductController.php`. All functions are public.

**showCart()**
Displays current cart data when user navigates to their cart page. Gets a `$cartId` from the session, and retrieves all `CartItems` where the cart_id key matches the one from the session. Calculates total cost of cart using `$total` variable. Returns the `cart.blade.php` view with `$cartItems` retrieved from database and `$total`, as well as other data for updating the item count in the navbar component.

**editItemFromCart(Request $request, $product_id)**
Edits the `CartItem` from the database's quantity when the quantity dropdown's value is changed. Functions similarily to `removeFromCart()`. The `CartItem` has a quantity column that gets modified as a result. Returns a JSON response.

**removeFromCart($item_id)**
Used to remove a `CartItem` from the cart. Finds the `CartItem` with the `$item_id` argument and removes it from the database, effectively updating the cart in the view. Returns a redirect back to the cart view.

**clearCart()**
Clears the cart of all `CartItems`. Uses the session id to find the `$cartId` then remove all assosciate `$cartItems` from the cart. The cart is still in session after and a new cart is NOT created until a new session is started. Returns a redirect back to the cart view with the now empty cart.

### Controller.php
#### Author: Laravel
Base class for all controllers. Unmodified for the scope of this project, but needed for other controllers to properly function.

### NavigationController.php
#### Author: Michael Boisvenu-Landry
Primarily used for directing the user to the home page. Passes data needed to home page so it displays correctly with all the products. Only hosts one public function.

**index()**
Creates arrays of products to pass to `home.blade.php`. Passes `$categories` so that the view can properly iterate through each array of products and display the correct ones. Gets products with highest rating, newest creation date, and those under $20. Loops are used in `home.blade.php` to iterate through each array and create 6 `<x-home-products>` components for each set.

### OrderController.php
#### Author: Michael Boisvenu-Landry
Controller used for performing create and read operations on an order. Once an order is placed it cannot directly be updated or deleted by the user. All functions are public.

**showOrder(Request $request)**
Returns the `checkout-summary.blade.php` view with data of the in-session cart from the database. Performs get operations on the products table to retrieve each `CartItem` with matching `$cartId` and product ids. The `$request` argument is unused.

**viewPlacedOrder($orderId)**
Used from the `user-profile.blade.php` view to fetch data about a 'processed' order assosciated with the user, and pass said data to the `order.blade.php` view (which it returns).

**processOrder(Request $request)**
Uses `$request` to validate data provided by user in the `checkout-summary.blade.php` view. Creates an order in the database with cart and user information, and then removes current cart from the session. Redirects to the home page with success messages.

### SearchController.php
#### Author: David Currey
Used to populate results in the `search-results.blade.php` view. All functions are public.

**search(Request $request)**
Uses `$request` from the search form present in the navbar, submits a POST request to the database to try to find items that match the search term. Returns the search results view with `$products` that match the term.

**listOnSale()**
Returns the search results view with all items that have the `is_on_sale` column set to 1/true.

### UserController.php
#### Author: Michael Boisvenu-Landry, Shuhan Han
Handles user authentication, registration, updates, profile, and recovery. All functions are public

**logout()**
Logs the user out and redirects to the home page view.

**showProfile(Request $request)**
Gets all the user data from the authenticated user and passes it to the `user-profile.blade.php` view (which it returns). Also redirects to registration view if a non-authenticated user attemps to access the route.

**recover()**
Feature was never implemented, redirects to the login page with a warning message.

**updatePicture(Request $request)**
Validates a user uploaded file via its MIMES, then converts image to binary and saves to database so it persists with each authentication. Image is received via `$request`.

**updateProfile(Request $request)**
Validates user form (via `$request` argument) to ensure compatibility with the entity in the database, then updates that user in the database with valid data. Returns a redirect to the profile view with updated information

**login(Request $request)**
First validates the user form via `$request` argument, then decrpyts stored password, ensures it matches and if it does it creates a session token for that user deeming them authenticated. Redirects to home page with success message. An authenticated user has a modified navbar, the ability to add items to cart and modify said cart, edit their profile and process an order.

**register(Request $request)**
Validates the registration form via `$request`. Adds new user to database with encrypted password, then authenticates that user and redirects them to the home page with a session token.

## Web.php
This file is locations in the routes directory. It handles all GET and POST requests from the application. Each route either uses GET or POST request as seen via `Route::get` or `Route::post`. Those methods take two arguments: the route which represents the physical URL (/login, /product/product_id etc), then uses the appropriate Controller method. Each controller method will either return a physical view, or a redirect to another page based on some action.

## JS and CSS Files
The following are a few JS and CSS Files occasionally used throughout the project. They can be found in **public** directory in there respective folders.

### bootstrap*.js, jquery*.js, popper*.js
#### Author: 3rd-party libraries
Files for self-hosting Bootstrap, comes with jQuery and Popper as part of the package. jQuery is used for the `<x-carousel>` component.

### bootstrap*.css, font-awesome.min.css, jquery*.css
#### Author: 3rd-party libraries
Files for hosting Bootstrap and other commonly used front-end libraries. Used on almost every page.

### login.js
#### Author: Maha Fouda
Front-end script for form validations.

### login.css, maha_style.css
#### Author: Maha Fouda
Styles used for forms on the login and registration pages.

### style_global.css
#### Author: Nnamdi Echegini, Maha Fouda
CSS styles used commonly throughout the project, does not contain any Bootstrap overrides, but focuses mostly on elements that do not utilize Bootstrap.

### test/product_categories.json
#### Author: Shuhan Han
Used to directly populate the product_categories table in the database. Import at deployment using MySQL Workbench's Import Wizard.

### test/products.json
#### Author: Shuhan Han
Similar to the previous JSON file but for products. Used directly within MySQL Workbench.

